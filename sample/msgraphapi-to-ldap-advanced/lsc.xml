<?xml version="1.0" ?>
<lsc xmlns="http://lsc-project.org/XSD/lsc-core-2.2.xsd"
     xmlns:msgraphapi="http://lsc-project.org/XSD/lsc-microsoft-graph-api-plugin-1.0.xsd" revision="0">
    <connections>
        <ldapConnection>
            <name>openldap</name>
            <url>ldap://localhost/dc=example,dc=org</url>
            <username>cn=admin,dc=example,dc=org</username>
            <password>admin</password>
            <authentication>SIMPLE</authentication>
            <referral>THROW</referral>
            <derefAliases>NEVER</derefAliases>
            <version>VERSION_3</version>
            <pageSize>-1</pageSize>
            <factory>com.sun.jndi.ldap.LdapCtxFactory</factory>
            <tlsActivated>false</tlsActivated>
            <saslMutualAuthentication>false</saslMutualAuthentication>
        </ldapConnection>
        <pluginConnection>
            <name>msgraphapi</name>
            <url></url>
            <username></username>
            <password></password>
            <msgraphapi:msGraphApiConnectionSettings>
                <msgraphapi:authenticationURL>${MS_GRAPH_API_AUTHENTICATION_URL}</msgraphapi:authenticationURL>
                <msgraphapi:usersURL>${MS_GRAPH_API_USERS_URL}</msgraphapi:usersURL>
                <msgraphapi:scope>${MS_GRAPH_API_SCOPE}</msgraphapi:scope>
                <msgraphapi:clientId>${MS_GRAPH_API_CLIENT_ID}</msgraphapi:clientId>
                <msgraphapi:clientSecret>${MS_GRAPH_API_CLIENT_SECRET}</msgraphapi:clientSecret>
                <msgraphapi:tenant>${MS_GRAPH_API_TENANT}</msgraphapi:tenant>
            </msgraphapi:msGraphApiConnectionSettings>
        </pluginConnection>
    </connections>
    <audits/>
    <tasks>
        <task>
            <name>users</name>
            <bean>org.lsc.beans.SimpleBean</bean>
            <pluginSourceService implementationClass="org.lsc.plugins.connectors.msgraphapi.MsGraphApiUsersSrcService">
                <name>msgraphapisrc</name>
                <connection reference="msgraphapi"/>
                <msgraphapi:msGraphApiUsersService>
                    <name>msgraphapi-users-service-src</name>
                    <connection reference="msgraphapi"/>
                    <msgraphapi:filter>startsWith(mail, 'a')</msgraphapi:filter>
                    <msgraphapi:pivot>userPrincipalName</msgraphapi:pivot>
                    <msgraphapi:pageSize>999</msgraphapi:pageSize>
                    <msgraphapi:select>userPrincipalName,mail,displayName,onPremisesExtensionAttributes</msgraphapi:select>
                </msgraphapi:msGraphApiUsersService>
            </pluginSourceService>
            <ldapDestinationService>
                <name>ldapdst</name>
                <connection reference="openldap"/>
                <baseDn>ou=users,dc=example,dc=org</baseDn>
                <pivotAttributes>
                    <string>uid</string>
                </pivotAttributes>
                <fetchedAttributes>
                    <string>objectClass</string>
                    <string>uid</string>
                    <string>cn</string>
                    <string>mail</string>
                    <string>sn</string>
		    <string>description</string>
                </fetchedAttributes>
                <getAllFilter>(&amp;(objectClass=person)(uid=*))</getAllFilter>
                <getOneFilter>(&amp;(objectClass=person)(uid={userPrincipalName}))</getOneFilter>
            </ldapDestinationService>
            <propertiesBasedSyncOptions>
                <mainIdentifier>"uid=" + javax.naming.ldap.Rdn.escapeValue(srcBean.getDatasetFirstValueById('userPrincipalName')) + ",ou=users,dc=example,dc=org";</mainIdentifier>
                <defaultDelimiter>;</defaultDelimiter>
                <defaultPolicy>FORCE</defaultPolicy>
                <conditions>
                    <create>true</create>
                    <update>true</update>
                    <delete>true</delete>
                    <changeId>true</changeId>
                </conditions>
                <dataset>
                    <name>objectClass</name>
                    <forceValues>
                        <string>"inetOrgPerson"</string>
                    </forceValues>
                </dataset>
                <dataset>
                    <name>cn</name>
                    <forceValues>
                        <string>srcBean.getDatasetFirstValueById("displayName")</string>
                    </forceValues>
                </dataset>
                <dataset>
                    <name>uid</name>
                    <forceValues>
                        <string>srcBean.getDatasetFirstValueById("userPrincipalName")</string>
                    </forceValues>
                </dataset>
                <dataset>
                    <name>sn</name>
                    <forceValues>
                        <string>srcBean.getDatasetValuesById("displayName")</string>
                    </forceValues>
                </dataset>
                <dataset>
                    <name>description<name>
                    <forceValues>
                    <string>srcBean.getDatasetFirstValueById("onPremisesExtensionAttributes/extensionAttribute1")</string>
                    </forceValues>
                </dataset>
            </propertiesBasedSyncOptions>
        </task>
    </tasks>
</lsc>
